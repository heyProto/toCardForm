!function(e){function t(n){if(a[n])return a[n].exports;var r=a[n]={exports:{},id:n,loaded:!1};return e[n].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var a={};return t.m=e,t.c=a,t.p="",t(0)}([function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=a(1),i=n(o),s=a(2),c=n(s),l=a(3),u=n(l),d=a(5),p=n(d);"object"===r(window.viewCast)?c.default.render(i.default.createElement(p.default,null),document.getElementById("root")):c.default.render(i.default.createElement(u.default,null),document.getElementById("root"))},function(e,t){e.exports=React},function(e,t){e.exports=ReactDOM},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),c=a(1),l=n(c),u=a(4),d=n(u),p=function(e){function t(e){r(this,t);var a=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.state={currentStep:1,currentCard:null,cards:[],cardData:[]},a.handleSelectCardClick=a.handleSelectCardClick.bind(a),a.handleSelectConfirmCard=a.handleSelectConfirmCard.bind(a),a.handlePublishClick=a.handlePublishClick.bind(a),a}return i(t,e),s(t,[{key:"componentDidMount",value:function(){var e=this,t=d.default.create({baseURL:window.baseURL});t.defaults.headers["Access-Token"]=window.accessToken,t.defaults.headers["Content-Type"]="application/json",t.get(window.baseURL+"/accounts/"+window.accountSlug+"/template_cards/",{timeout:5e3}).then(function(t){console.log(t,"response"),e.setState({cards:t.data.template_cards})})}},{key:"handleSelectCardClick",value:function(e){var t=this,a=e.target.closest(".single-element"),n=d.default.create({baseURL:window.baseURL});n.defaults.headers["Access-Token"]=window.accessToken,n.defaults.headers["Content-Type"]="application/json",n.get(window.baseURL+"/accounts/"+window.accountSlug+"/template_cards/"+a.id,{timeout:5e3}).then(function(e){console.log(e,"response of card data");var a=e.data.template_card,n={currentCard:a,accountID:a.account_id,APIName:a.git_repo_name,templateDatumID:a.template_datum_id,templateCardID:a.id};t.setState(n),t.handleSelectConfirmCard(n.currentCard)})}},{key:"handleSelectConfirmCard",value:function(e){var t=this,a=document.createElement("script"),n=void 0;this.setState({currentStep:2}),document.body.appendChild(a),a.onreadystatechange=a.onload=function(){n||t.renderCard(e),n=!0},a.setAttribute("src",e.files.edit_file_js);var r=document.createElement("link");r.rel="stylesheet",r.href=e.files.css,document.head.appendChild(r)}},{key:"handlePublishClick",value:function(){var e=d.default.create({baseURL:window.baseURL}),t=this.state.protoGraphInstance.getData();return e.defaults.headers["Access-Token"]=window.accessToken,e.defaults.headers["Content-Type"]="application/json",e.post(window.baseURL+"/accounts/"+window.accountSlug+"/datacasts",{datacast:t.dataJSON,view_cast:{account_id:this.state.accountID,template_datum_id:this.state.templateDatumID,name:t.name,template_card_id:this.state.templateCardID,seo_blockquote:"function"==typeof this.state.protoGraphInstance.renderSEO?this.state.protoGraphInstance.renderSEO():"",optionalConfigJSON:JSON.stringify(t.optionalConfigJSON)}}).then(function(e){console.log(e,"post response"),window.location.href=e.data.redirect_path}).catch(function(e){"undefined"!=typeof _errs&&_errs.push(e);var t=e.response.data.error_message;t?showAllValidationErrors(t):generate_notify({text:e.response.statusText,notify:"error"})})}},{key:"getProtoInstance",value:function(e){switch(e){case"ProtoGraph.Card.toSocial":return new ProtoGraph.Card.toSocial;case"ProtoGraph.Card.toExplain":return new ProtoGraph.Card.toExplain}}},{key:"renderCard",value:function(e){var t=this.getProtoInstance(e.git_repo_name),a={selector:document.querySelector("#protograph_edit_form_holder"),data_url:e.files.schema_files.sample,schema_url:e.files.schema_files.schema,configuration_url:e.files.configuration_sample,configuration_schema_url:e.files.configuration_schema};e.files.ui_schema&&(a.ui_schema_url=e.files.ui_schema),t.init(a),this.setState({protoGraphInstance:t}),t.renderEdit(this.handlePublishClick)}},{key:"renderCardSelector",value:function(){var e=this,t=this.state.cards.map(function(t,a){return l.default.createElement("div",{key:a,className:"single-element",id:t.slug,onClick:e.handleSelectCardClick},l.default.createElement("div",{className:"card-type-icon","data-tooltip":t.account_slug+" / "+t.name,"data-position":"bottom center"},l.default.createElement("img",{src:t.icon_url})))});return l.default.createElement("div",{className:"ui main container"},l.default.createElement("h4",null," Select a card type "),l.default.createElement("div",{className:"protograph-toCardForm-cardsIconContainer"},t.length>=0&&t))}},{key:"renderCardWYSIWYG",value:function(){return l.default.createElement("div",{className:"proto-grey-body"},l.default.createElement("div",{id:"protograph_edit_form_holder"},"Loading"))}},{key:"render",value:function(){switch(this.state.currentStep){case 1:return this.renderCardSelector();case 2:return this.renderCardWYSIWYG()}}}]),t}(c.Component);t.default=p},function(e,t){e.exports=axios},function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),_react=__webpack_require__(1),_react2=_interopRequireDefault(_react),_axios=__webpack_require__(4),_axios2=_interopRequireDefault(_axios),Update=function(_Component){function Update(e){_classCallCheck(this,Update);var t=_possibleConstructorReturn(this,(Update.__proto__||Object.getPrototypeOf(Update)).call(this,e));return t.state={currentStep:2,showSteps:!0,showUpdate:!0,updatedInstance:null},t.handlePublishClick=t.handlePublishClick.bind(t),t}return _inherits(Update,_Component),_createClass(Update,[{key:"componentDidMount",value:function(){var e=this,t=window.viewCast.template_card,a=document.createElement("script"),n=void 0;document.body.appendChild(a),a.onreadystatechange=a.onload=function(){n||e.renderUpdateCard(t),n=!0},a.setAttribute("src",t.files.edit_file_js);var r=document.createElement("link");r.rel="stylesheet",r.href=t.files.css,document.head.appendChild(r)}},{key:"renderUpdateCard",value:function renderUpdateCard(card){var update_x=eval("new "+card.git_repo_name+"()"),options={selector:document.querySelector("#view_area"),data_url:window.viewCast.remote_urls.data_url,schema_url:window.viewCast.remote_urls.schema_json,configuration_url:window.viewCast.remote_urls.configuration_url,configuration_schema_url:window.viewCast.template_card.files.configuration_schema};window.viewCast.template_card.files.ui_schema&&(options.ui_schema_url=window.viewCast.template_card.files.ui_schema),update_x.init(options),this.setState({updatedInstance:update_x}),update_x.renderEdit(this.handlePublishClick)}},{key:"handlePublishClick",value:function(){var e=_axios2.default.create({baseURL:window.baseURL}),t=this.state.updatedInstance.getData();return e.defaults.headers["Access-Token"]=window.accessToken,e.defaults.headers["Content-Type"]="application/json",e.put(window.baseURL+"/accounts/"+window.accountSlug+"/datacasts/"+window.viewCast.id,{datacast:t.dataJSON,view_cast:{account_id:this.state.accountID,template_datum_id:this.state.templateDatumID,name:t.name,template_card_id:this.state.templateCardID,seo_blockquote:"function"==typeof this.state.updatedInstance.renderSEO?this.state.updatedInstance.renderSEO():"",optionalConfigJSON:JSON.stringify(t.optionalConfigJSON)}}).then(function(e){console.log(e,"put response"),window.location.href=e.data.redirect_path}).catch(function(e){"undefined"!=typeof _errs&&_errs.push(e);var t=e.response.data.error_message;t?showAllValidationErrors(t):generate_notify({text:e.response.statusText,notify:"error"})})}},{key:"render",value:function(){return _react2.default.createElement("div",{className:"card-update-container ui grid"},_react2.default.createElement("div",{className:"steps-area sixteen wide column"},_react2.default.createElement("div",{id:"view_area",className:"selected-card-preview"})))}}]),Update}(_react.Component);exports.default=Update}]);